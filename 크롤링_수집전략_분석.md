# 직항(Zighang) 크롤링 수집 전략 분석

## 📊 수집 항목별 크롤링 방식 매핑

### ✅ **거의 100% 수집 필수 항목**

| 항목 | 1순위 | 2순위 | 3순위 | 최종 성공률 | 비고 |
|------|------|------|------|------------|------|
| **제목** | RSC: `recruitment.title` | LD+JSON: `title` | CSS: `h1` | **100%** | 모든 방식에서 필수 제공 |
| **기업명** | RSC: `recruitment.company.name` | LD+JSON: `hiringOrganization.name` | CSS: `a[href*="/company/"]` | **100%** | 모든 방식에서 필수 제공 |
| **직무 (depth_ones)** | RSC: `recruitment.depthOnes` | LD+JSON: OG태그에서 추출 | CSS: 본문 키워드 추출 | **95%** | RSC 실패 시 OG태그 파싱 |
| **직무 (depth_twos)** | RSC: `recruitment.depthTwos` | ❌ 없음 | CSS: 본문 키워드 추출 | **70%** | ⚠️ RSC 실패 시 대체 방안 필요 |
| **요구 경력** | RSC: `recruitment.careerMin` | CSS: "경력무관", "1년~3년" 텍스트 파싱 | LD+JSON: `experienceRequirements` 파싱 | **90%** | 텍스트 파싱으로 보강 가능 |
| **지역** | RSC: `recruitment.regions[0]` | LD+JSON: `jobLocation[0].address.addressLocality` | CSS: 공고 요약 박스 | **98%** | LD+JSON fallback 안정적 |
| **고용형태** | RSC: `recruitment.employeeTypes` | LD+JSON: `employmentType` (매핑 필요) | CSS: 공고 요약 박스 | **98%** | LD+JSON에서 FULL_TIME → 정규직 변환 |
| **기업유형** | RSC: `recruitment.company.type` | CSS: badge 태그 | companies 테이블 조인 | **80%** | ⚠️ 별도 companies 크롤링 필요 |
| **담당업무** | RSC: `recruitment.content` (ProseMirror) | CSS: `h3:contains('담당업무')` + 본문 | LD+JSON: `description` | **95%** | 섹션 파싱 안정적 |
| **자격요건** | RSC: `recruitment.content` (ProseMirror) | CSS: `h3:contains('자격요건')` + 본문 | - | **95%** | 섹션 파싱 안정적 |
| **마감일** | RSC: `recruitment.deadlineType` + `endDate` | CSS: 공고 요약 박스 | LD+JSON: `validThrough` | **90%** | "채용시마감", "상시채용" 등 |

---

### 🔍 **추가 수집 희망 항목**

| 항목 | 1순위 | 2순위 | 성공률 | 비고 |
|------|------|------|-------|------|
| **주소 (상세)** | CSS: 지도 영역 또는 회사 정보 박스 | companies 테이블 조인 | **60%** | ⚠️ 공고에 없는 경우 많음 |
| **접수방법** | CSS: `h3:contains('접수방법')` + 본문 | RSC: `content` 파싱 | **85%** | 섹션 파싱 |

---

### ❌ **수집 제외 항목**

- 회사 소개
- 공고 출처 (이미 `source: 'zighang'` 고정)

---

## 🎯 최종 권장 크롤링 전략

### **단계별 Fallback 로직**

```
1차 시도: RSC Flight Data 추출
  ├─ 성공 → 모든 필드 확보 (100%)
  └─ 실패 ↓

2차 시도: LD+JSON + CSS Selector 조합
  ├─ LD+JSON에서: 제목, 기업명, 지역, 고용형태
  ├─ CSS Selector로: 경력, 담당업무, 자격요건, 마감일, 접수방법
  └─ 성공률: 90%

3차 시도: CSS Selector 전면 파싱
  └─ 공고 요약 박스 + 섹션 헤더 기반 추출
  └─ 성공률: 80%
```

---

## ⚠️ 개선 필요 항목

### **1. depth_twos (직무 세부 분류)**

**현재 문제**: RSC 실패 시 수집 불가 → 필터링 탈락

**해결 방안**:
1. **OG 태그 활용**: `og:title` 마지막 부분에서 추출
   - 예: `"[넥스트증권] Operation Leader 채용 | 증권_운용"` → `"증권_운용"`
2. **본문 키워드 추출**: NLP 또는 정규식으로 직무 키워드 추출
3. **companies 테이블 조인**: 회사의 주력 산업/직무 정보 활용

### **2. 기업유형**

**현재 문제**: RSC 없으면 수집 어려움

**해결 방안**:
1. **별도 companies 크롤링**: 회사 상세 페이지에서 기업 유형 수집
2. **텍스트 추론**: 회사명으로 추론 (예: "주식회사" → 대기업, "복지센터" → 비영리)

### **3. 요구 경력 (careerMin)**

**현재 문제**: LD+JSON에서 `experienceRequirements`가 문자열 (예: "84 months")

**해결 방안**:
```javascript
function parseCareer(text) {
  if (!text) return null;

  // "경력무관", "신입" 등
  if (/무관|신입|경력\s*없/i.test(text)) return 0;

  // "1년~3년", "3-5년"
  const rangeMatch = text.match(/(\d+)\s*[년~-]\s*(\d+)/);
  if (rangeMatch) return parseInt(rangeMatch[1]);

  // "84 months"
  const monthMatch = text.match(/(\d+)\s*months?/i);
  if (monthMatch) return Math.floor(parseInt(monthMatch[1]) / 12);

  // "5년 이상"
  const yearMatch = text.match(/(\d+)\s*년/);
  if (yearMatch) return parseInt(yearMatch[1]);

  return null;
}
```

---

## 📈 예상 수집률

| 시나리오 | 필수 항목 수집률 | 추가 항목 수집률 |
|---------|----------------|----------------|
| **RSC 성공** (70%) | 100% | 85% |
| **LD+JSON + CSS** (25%) | 92% | 70% |
| **CSS만** (5%) | 80% | 60% |
| **전체 평균** | **96.4%** | **79.5%** |

---

## 🔧 구현 우선순위

### **즉시 적용 (Critical)**
1. LD+JSON fallback 강화
2. CSS Selector로 공고 요약 박스 파싱
3. 경력 텍스트 파싱 함수 추가

### **2주 내 적용 (High)**
1. RSC 파싱 에러 디버깅 및 수정
2. OG 태그에서 depth_twos 추출
3. companies 테이블 조인 로직 추가

### **1개월 내 적용 (Medium)**
1. 본문 키워드 추출 (NLP)
2. 주소 정보 수집 강화
3. 접수방법 파싱 개선
