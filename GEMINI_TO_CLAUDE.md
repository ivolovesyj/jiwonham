# 📋 Gemini → Claude 작업 인수인계서

## 1. 개요
*   **목표**: 채용공고 크롤러(`zighang-full.js`) 고도화 및 DB/필터 로직 정비
*   **진행 상태**: `zighang-full_test_mj.js` (복사본)에서 크롤링 로직 테스트 중.

---

## 2. 채용공고 & 필터 로직 (확인 사항)
Supabase `jobs` 테이블의 배열 필드(`employee_types`, `depth_twos`)에 대한 검색 필터 작동 방식 확인 결과입니다.

### Q1. 고용형태 (`employee_types`) 필터링
*   **상황**: `jobs.employee_types`에 데이터가 배열로 저장됨. (예: `["계약직", "정규직"]`, `["계약직", "병역특례"]`)
*   **질문**: 이용자가 필터에서 '계약직' 하나만 선택했을 때, 위 두 공고가 모두 노출되어야 하는가?
*   **결로**: **✅ YES (노출됨)**
    *   OR 조건(`array_contains` / `&&` 연산)으로 동작하므로, 배열 내에 하나라도 포함되면 검색 결과에 나와야 합니다.

### Q2. 직무 소분류 (`depth_twos`) 필터링
*   **상황**: `jobs.depth_twos`에 데이터가 배열로 저장됨. (예: `["인사기획", "평가_보상", "HRD_조직문화"]`)
*   **질문**: 이용자가 '인사기획'만 선택해도 해당 공고가 노출되어야 하는가?
*   **결론**: **✅ YES (노출됨)**
    *   동일하게 OR 조건으로 처리됩니다.

---

## 3. 크롤러 고도화 요구사항 (구현 필요)

### A. 학력 정보 (`education`) 추가
*   **소스**: 공고 상세 페이지(Job RSC) 내 `education` 필드.
*   **작업**:
    1.  RSC에서 `education` 데이터 추출.
    2.  DB `jobs` 테이블에 `education` 컬럼 추가 및 저장.
    3.  **필터 매핑**: 무관, 고졸, 전문대졸, 학사, 석사, 박사.

### B. 기업 정보 (주소/유형) 크롤링 방식 변경
기존에는 별도 회사 DB를 썼으나, 이제는 **크롤링 시 실시간 수집**으로 변경합니다.

#### 1. 상세 페이지 수집 분기 처리
*   공고 RSC의 `hasDetailInfo` 값에 따라 분기:
    *   **`true`인 경우**: `https://zighang.com/company/{company_id}` 로 추가 요청(Sub-request) 보내서 상세 정보 파싱.
    *   **`false`인 경우 (Fallback)**:
        *   회사 주소 ➔ `'정보없음'` 저장
        *   회사 유형 ➔ `'중소기업'` (기본값) 저장

#### 2. 상세 페이지 파싱 로직 (RSC 파싱)
`company_id` 페이지의 RSC 데이터(`all_companies_rsc_dump.txt` 참고)에서 아래 규칙으로 추출합니다.

**① 회사 유형 (`company_type`)**
*   **위치**: `["$", "meta", "3", ...]` (Keywords 태그)
*   **로직**: `content` 문자열을 쉼표(`,`)로 분리했을 때, **뒤에서 두 번째 항목**을 추출.
    *   예: `"채용,...,인투셀,스타트업,대전"` ➔ **'스타트업'** 추출
    *   값 예시: 스타트업, 대기업, 유니콘, 중견기업 등.

**② 회사 주소 (`address`)**
*   **위치**: `["$", "meta", "1", ...]` (Description 태그)
*   **로직**: `content` 문자열 내용 중 `"본사는 "` 뒤에서부터 `"에 위치"` 앞까지 추출.
    *   예: `"... 본사는 대전광역시 대덕구 신일동로 101에 위치해 있습니다."`
    *   ➔ **'대전광역시 대덕구 신일동로 101'** 추출

---

## 4. DB 스키마 작업 (Supabase)
    *   `company_type` (text) - (기존에 없었다면 추가, 기존 로직 대체)

---

## 5. UI 및 필터 로직 구현 (Frontend & Backend)
DB에 새로운 컬럼(`education`, `address`, `company_type`)이 추가됨에 따라, **필터링 로직과 UI에도 이를 반영해 주세요.**

### A. 필터 API 수정 (`web/app/api/filters/route.ts` 등)
1.  **필터 옵션 제공**:
    *   **학력**: [무관, 고졸, 전문대졸, 학사, 석사, 박사]
    *   **기업형태**: [대기업, 중견기업, 중소기업, 스타트업, 공공기관, 외국계, 유니콘] (크롤링된 데이터 기반)
    *   **지역**: 기존 로직 유지하되, `address` 컬럼 기반으로 필터링 동작 확인.

### B. 검색 API 수정 (`web/app/api/jobs/route.ts` 또는 RPC)
1.  **필터링 적용**: 사옹자가 위 옵션을 선택했을 때, DB의 `education`, `company_type` 컬럼을 조회하여 필터링되도록 쿼리 수정.
2.  **노출 로직**:
    *   **학력**: 선택된 학력 *이상* 또는 *포함* 조건 (사용자 기획 의도에 맞게 설정 필요, 보통은 "포함" 또는 "해당 학력 지원 가능")
    *   **기업형태**: 선택된 형태가 포함된 공고 노출 (OR 조건).

### C. UI 반영 (`web/app/jobs/page.tsx` 등)
1.  **사이드바/필터 영역**: 학력, 기업형태 체크박스 필터 그룹 추가.
2.  **공고 카드**:
    *   수집된 **기업형태** (예: "스타트업", "KOSDAQ") 뱃지 표시.
    *   **학력 정보** 표시.
    *   **상세 주소** 표시 (기존보다 더 정확한 주소 노출).
